<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gemini Weather App</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-size: cover;
      background-position: center;
      color: white;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
      transition: background-image 0.5s ease-in-out;
    }
    .weather-container {
      text-align: center;
      background: rgba(0, 0, 0, 0.55);
      backdrop-filter: blur(8px);
      padding: 25px;
      border-radius: 15px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      max-width: 700px;
      width: 90%;
    }
    .search-bar {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    .search-bar input {
      padding: 10px 15px;
      font-size: 1rem;
      border-radius: 20px 0 0 20px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(255, 255, 255, 0.1);
      color: white;
      outline: none;
      width: 70%;
    }
    .search-bar input::placeholder { color: #ccc; }
    .search-bar button {
      padding: 10px 15px;
      font-size: 1rem;
      border: none;
      background: #3498db;
      color: white;
      border-radius: 0 20px 20px 0;
      cursor: pointer;
      transition: background 0.3s ease;
    }
    .search-bar button:hover { background: #2980b9; }
    .city { font-size: 2.2rem; margin-bottom: 10px; font-weight: 600; }
    .temp { font-size: 4rem; margin: 10px 0; font-weight: 700; }
    .description { font-size: 1.3rem; text-transform: capitalize; margin-bottom: 20px; font-style: italic; }
    .details {
      margin-top: 20px;
      font-size: 1rem;
      text-align: left;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 20px;
      background: rgba(0, 0, 0, 0.2);
      padding: 15px;
      border-radius: 10px;
    }
    .forecast h3, .daily-forecast h3 { margin-top: 25px; margin-bottom: 10px; text-align: left; }
    .hours-wrapper { display: flex; overflow-x: auto; gap: 12px; padding: 10px 5px; }
    .hour-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 12px;
      border-radius: 10px;
      min-width: 85px;
      text-align: center;
      transition: transform 0.2s ease;
    }
    .hour-card:hover { transform: translateY(-5px); }
    .hour-card img { width: 45px; height: 45px; }
    .days-wrapper { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
    .day-card {
      background: rgba(255, 255, 255, 0.1);
      padding: 15px;
      border-radius: 10px;
      flex: 1 1 calc(25% - 10px);
      min-width: 100px;
      text-align: center;
      transition: background 0.3s ease;
    }
    .day-card:hover { background: rgba(255, 255, 255, 0.2); }
    .day-card img { width: 50px; height: 50px; }
    .bg-clear { background-image: url('https://images.unsplash.com/photo-1558485203-81b0a7019183'); }
    .bg-clouds { background-image: url('https://images.unsplash.com/photo-1502691873132-ce2a4f48b0a9'); }
    .bg-rain { background-image: url('https://images.unsplash.com/photo-1519692933481-cee63966da45'); }
    .bg-snow { background-image: url('https://images.unsplash.com/photo-1542456041-8600d8f0f353'); }
    .bg-mist { background-image: url('https://images.unsplash.com/photo-1487621167335-f024066bda53'); }
    .bg-thunderstorm { background-image: url('https://images.unsplash.com/photo-1605727226549-358ab4e23c3b'); }
  </style>
</head>
<body>
  <div class="weather-container">
    <div class="search-bar">
      <input type="text" id="cityInput" placeholder="Enter city name...">
      <button onclick="searchCity()">Search</button>
    </div>
    <h1 class="city">Detecting location...</h1>
    <p class="temp"></p>
    <p class="description"></p>
    <div id="current-details"></div>
    <div class="forecast"></div>
    <div class="daily-forecast"></div>
  </div>

  <script>
    const apiKey = "5799c742a7478cfa8752374b992d0074";
    const cityElement = document.querySelector(".city");
    const tempElement = document.querySelector(".temp");
    const descriptionElement = document.querySelector(".description");
    const detailsContainer = document.getElementById("current-details");
    const hourlyContainer = document.querySelector(".forecast");
    const dailyContainer = document.querySelector(".daily-forecast");

    document.addEventListener("DOMContentLoaded", initWeatherApp);
    document.getElementById("cityInput").addEventListener("keyup", (event) => {
        if (event.key === "Enter") {
            searchCity();
        }
    });

    function initWeatherApp() {
      if (apiKey === "YOUR_API_KEY_HERE") {
        cityElement.textContent = "Please add API Key!";
        return;
      }
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          async (pos) => {
            const { latitude, longitude } = pos.coords;
            getWeatherData(latitude, longitude);
          },
          () => {
            cityElement.textContent = "Location access denied. Please search for a city.";
            // Fallback to a default city if location is blocked
            getWeatherDataByCity("London");
          }
        );
      } else {
        cityElement.textContent = "Geolocation is not supported by your browser.";
        getWeatherDataByCity("New York");
      }
    }

    async function getWeatherData(lat, lon) {
      try {
        const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${apiKey}`);
        const geoData = await geoRes.json();
        if (geoData.length > 0) {
          cityElement.textContent = `${geoData[0].name}, ${geoData[0].country}`;
        }

        const weatherRes = await fetch(
          `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=minutely&appid=${apiKey}&units=metric`
        );
        const weatherData = await weatherRes.json();
        updateUI(weatherData);
      } catch (err) {
        console.error("Weather fetch error:", err);
        cityElement.textContent = "Failed to fetch weather.";
      }
    }

    async function getWeatherDataByCity(city) {
        try {
            const geoRes = await fetch(`https://api.openweathermap.org/geo/1.0/direct?q=${city}&limit=1&appid=${apiKey}`);
            const geoData = await geoRes.json();
            if (geoData.length === 0) {
                cityElement.textContent = "City not found!";
                return;
            }
            const { lat, lon, name, country } = geoData[0];
            cityElement.textContent = `${name}, ${country}`;
            getWeatherData(lat, lon);
        } catch (err) {
            console.error("City search error:", err);
            cityElement.textContent = "Error searching for city.";
        }
    }

    function updateUI(data) {
        updateCurrentWeather(data.current);
        updateHourlyForecast(data.hourly);
        updateDailyForecast(data.daily);
    }

    function updateCurrentWeather(current) {
      tempElement.textContent = `${Math.round(current.temp)}¬∞C`;
      descriptionElement.textContent = current.weather[0].description;
      setDynamicBackground(current.weather[0].main.toLowerCase());

      detailsContainer.innerHTML = `
        <div class="details">
          <p>üå°Ô∏è Feels Like: ${Math.round(current.feels_like)}¬∞C</p>
          <p>üíß Humidity: ${current.humidity}%</p>
          <p>üå¨Ô∏è Wind: ${current.wind_speed} m/s</p>
          <p>üìà Pressure: ${current.pressure} hPa</p>
          <p>‚òÄÔ∏è UV Index: ${current.uvi} (${getUviDescription(current.uvi)})</p>
          <p>üëÄ Visibility: ${(current.visibility / 1000).toFixed(1)} km</p>
        </div>
      `;
    }

    function updateHourlyForecast(hourly) {
      hourlyContainer.innerHTML = "<h3>Hourly Forecast</h3>";
      const wrap = document.createElement("div");
      wrap.classList.add("hours-wrapper");
      hourlyContainer.appendChild(wrap);
      hourly.slice(0, 12).forEach(h => {
        const hourCard = document.createElement("div");
        hourCard.classList.add("hour-card");
        hourCard.innerHTML = `
          <p>${new Date(h.dt * 1000).getHours()}:00</p>
          <img src="https://openweathermap.org/img/wn/${h.weather[0].icon}@2x.png" alt="${h.weather[0].description}">
          <p>${Math.round(h.temp)}¬∞C</p>
        `;
        wrap.appendChild(hourCard);
      });
    }

    function updateDailyForecast(daily) {
      dailyContainer.innerHTML = "<h3>7 Day Forecast</h3>";
      const wrap = document.createElement("div");
      wrap.classList.add("days-wrapper");
      dailyContainer.appendChild(wrap);
      daily.slice(1, 8).forEach(d => { // Slice 1 to 8 to get the next 7 days
        const dayCard = document.createElement("div");
        dayCard.classList.add("day-card");
        dayCard.innerHTML = `
          <p><b>${new Date(d.dt * 1000).toLocaleDateString("en-US", { weekday: "short" })}</b></p>
          <img src="https://openweathermap.org/img/wn/${d.weather[0].icon}@2x.png" alt="${d.weather[0].description}">
          <p>${Math.round(d.temp.max)}¬∞ / ${Math.round(d.temp.min)}¬∞</p>
        `;
        wrap.appendChild(dayCard);
      });
    }
    
    function searchCity() {
      const city = document.getElementById("cityInput").value.trim();
      if (!city) return;
      getWeatherDataByCity(city);
    }

    function setDynamicBackground(cond) {
      let className = 'bg-clear'; // Default background
      if (cond.includes("cloud")) className = 'bg-clouds';
      else if (cond.includes("rain") || cond.includes("drizzle")) className = 'bg-rain';
      else if (cond.includes("snow")) className = 'bg-snow';
      else if (cond.includes("thunderstorm")) className = 'bg-thunderstorm';
      else if (cond.includes("mist") || cond.includes("fog") || cond.includes("haze")) className = 'bg-mist';
      document.body.className = className;
    }

    function getUviDescription(uvi) {
        if (uvi < 3) return "Low";
        if (uvi < 6) return "Moderate";
        if (uvi < 8) return "High";
        if (uvi < 11) return "Very High";
        return "Extreme";
    }

  </script>
</body>
</html>
